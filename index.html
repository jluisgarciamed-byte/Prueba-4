<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geoportal Participativo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== VARIABLES CSS ===== */
        :root {
            --primary: #10b981;          /* Color principal verde */
            --primary-dark: #059669;     /* Verde oscuro */
            --primary-light: #34d399;    /* Verde claro */
            --secondary: #3b82f6;        /* Color secundario azul */
            --secondary-dark: #2563eb;   /* Azul oscuro */
            --dark: #1f2937;             /* Fondo oscuro */
            --darker: #111827;           /* Fondo m√°s oscuro */
            --light: #f8fafc;            /* Texto claro */
            --gray: #6b7280;             /* Texto gris */
            --gray-light: #e5e7eb;       /* Bordes grises */
            --success: #10b981;          /* Color √©xito */
            --warning: #f59e0b;          /* Color advertencia */
            --error: #ef4444;            /* Color error */
        }

        /* ===== ESTILOS GENERALES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            line-height: 1.6;
            overflow: hidden;
        }

        /* ===== ENCABEZADO ===== */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
            position: relative;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Logo del geoportal */
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo i {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo h1 {
            font-weight: 700;
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Barra de b√∫squeda */
        .search-container {
            position: relative;
            width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Resultados de b√∫squeda */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            margin-top: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .result-type {
            font-size: 0.7rem;
            color: var(--primary-light);
            margin-top: 0.25rem;
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .main-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        /* ===== PANEL LATERAL ===== */
        .sidebar {
            width: 400px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            padding: 1.5rem;
        }

        /* Paneles individuales */
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
            overflow: hidden;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .panel:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }

        /* Encabezado de panel */
        .panel-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .panel-header i {
            font-size: 1.1rem;
        }

        .panel-header h3 {
            font-weight: 600;
            font-size: 1rem;
        }

        /* Cuerpo del panel */
        .panel-body {
            padding: 1.5rem;
        }

        /* ===== MAPAS BASE ===== */
        .basemap-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .basemap-item {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .basemap-item:hover {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.1);
            transform: translateY(-2px);
        }

        .basemap-item.active {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.15);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .basemap-item i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-light);
        }

        .basemap-item.active i {
            color: var(--primary);
        }

        .basemap-item span {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--light);
        }

        /* ===== CAPAS ===== */
        .layers-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .layer-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .layer-item:hover {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.1);
            transform: translateY(-2px);
        }

        .layer-item.active {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.15);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        /* Icono de capa */
        .layer-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .layer-info {
            flex: 1;
        }

        .layer-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            color: var(--light);
        }

        .layer-type {
            font-size: 0.75rem;
            color: var(--primary-light);
        }

        /* Toggle de capa */
        .layer-toggle {
            width: 48px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .layer-toggle.active {
            background: var(--primary);
        }

        .layer-toggle::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .layer-toggle.active::after {
            transform: translateX(24px);
        }

        /* ===== FORMULARIO DE REPORTES ===== */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: var(--light);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            backdrop-filter: blur(10px);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            background: rgba(255, 255, 255, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Contenedor de coordenadas */
        .coords-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .coords-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .coords-display i {
            color: var(--primary);
        }

        #coords-text {
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.8rem;
            color: var(--primary-light);
        }

        .coords-actions {
            margin-bottom: 0.75rem;
        }

        /* Botones */
        .btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .btn-map {
            background: rgba(59, 130, 246, 0.1);
            color: var(--secondary);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .btn-map:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(59, 130, 246, 0.2);
        }

        .btn-set {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .btn-set:hover {
            background: rgba(245, 158, 11, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(245, 158, 11, 0.2);
        }

        .btn-send {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            margin-top: 1rem;
            border: none;
            font-weight: 600;
        }

        .btn-send:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -5px rgba(16, 185, 129, 0.4);
        }

        /* Coordenadas manuales */
        .coords-manual {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .coords-manual label {
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            display: block;
            color: var(--light);
        }

        .coords-inputs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .coord-input {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            backdrop-filter: blur(10px);
        }

        .coord-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* ===== PANEL DE ESTADO ===== */
        .status-panel {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin-top: 1rem;
            backdrop-filter: blur(10px);
        }

        .status-panel.success {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--primary-light);
        }

        .status-panel.error {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--error);
        }

        .status-panel.warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
            color: var(--warning);
        }

        /* ===== CONTENEDOR DEL MAPA ===== */
        .map-container {
            flex: 1;
            position: relative;
        }

        .map {
            height: 100%;
            width: 100%;
        }

        /* ===== LEYENDA DEL MAPA ===== */
        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            padding: 1.25rem;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-width: 220px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .legend-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--light);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-title i {
            color: var(--primary);
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .legend-color {
            width: 20px;
            height: 12px;
            margin-right: 0.75rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .legend-text {
            font-size: 0.8rem;
            color: var(--light);
        }

        /* ===== INDICADOR DE CARGA ===== */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            padding: 2rem 2.5rem;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 1000;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== CONTROLES DEL MAPA ===== */
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .control-btn {
            width: 48px;
            height: 48px;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.4);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* ===== SCROLLBAR PERSONALIZADO ===== */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* ===== ESTILOS PARA REPORTES ===== */
        .report-marker {
            background: none;
            border: none;
        }

        .report-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .report-pendiente { background-color: #f59e0b; }
        .report-en-proceso { background-color: #3b82f6; }
        .report-resuelto { background-color: #10b981; }

        /* ===== MODAL PARA USO DE SUELO ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-container {
            background: rgba(31, 41, 55, 0.95);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .modal-body {
            margin-bottom: 1.5rem;
        }

        .modal-footer {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-modal {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        .btn-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-save:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(16, 185, 129, 0.3);
        }

        /* ===== INFORMACI√ìN DE USO DE SUELO ===== */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            font-size: 0.8rem;
            color: var(--primary-light);
            margin-bottom: 0.25rem;
        }

        .info-value {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--light);
        }

        .info-section {
            margin-bottom: 1.5rem;
        }

        .info-section-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* ===== ANIMACI√ìN DE √âXITO ===== */
        .success-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .success-animation.active {
            opacity: 1;
            pointer-events: all;
        }

        .sombrero-container {
            position: relative;
            margin-bottom: 2rem;
        }

        .sombrero {
            font-size: 8rem;
            color: #8B4513;
            transform: translateY(-20px);
            animation: sombreroBounce 1s ease-in-out;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        @keyframes sombreroBounce {
            0% { transform: translateY(-100px) rotate(-10deg); opacity: 0; }
            50% { transform: translateY(10px) rotate(5deg); }
            70% { transform: translateY(-5px) rotate(-2deg); }
            100% { transform: translateY(0) rotate(0); opacity: 1; }
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #FFD700;
            box-shadow: 0 0 10px 2px #FFD700;
            animation: fireworkExplode 1.5s ease-out forwards;
        }

        @keyframes fireworkExplode {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        .success-message {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #10b981, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0;
            animation: messageFadeIn 0.5s ease-out 0.5s forwards;
        }

        @keyframes messageFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success-submessage {
            font-size: 1.5rem;
            color: var(--primary-light);
            text-align: center;
            opacity: 0;
            animation: messageFadeIn 0.5s ease-out 1s forwards;
        }
    </style>
</head>
<body>
    <!-- ENCABEZADO CON LOGO Y B√öSQUEDA -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-users"></i>
                <h1>Geoportal Participativo</h1>
            </div>
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Buscar localidad o colonia..." class="search-input">
                <div id="search-results" class="search-results"></div>
            </div>
        </div>
    </header>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="main-container">
        <!-- PANEL LATERAL IZQUIERDO -->
        <aside class="sidebar">
            <!-- PANEL DE MAPAS BASE -->
            <div class="panel">
                <div class="panel-header">
                    <i class="fas fa-map"></i>
                    <h3>Mapa Base</h3>
                </div>
                <div class="panel-body">
                    <div id="basemaps" class="basemap-grid"></div>
                </div>
            </div>

            <!-- PANEL DE CAPAS -->
            <div class="panel">
                <div class="panel-header">
                    <i class="fas fa-layer-group"></i>
                    <h3>Capas</h3>
                </div>
                <div class="panel-body">
                    <div id="layers" class="layers-container"></div>
                </div>
            </div>

            <!-- PANEL DE REPORTES -->
            <div class="panel">
                <div class="panel-header">
                    <i class="fas fa-comment-medical"></i>
                    <h3>Enviar Reporte</h3>
                </div>
                <div class="panel-body">
                    <div class="report-form">
                        <!-- Formulario para enviar reportes ciudadanos -->
                        <div class="form-group">
                            <label for="nombre">Nombre</label>
                            <input type="text" id="nombre" class="form-input" placeholder="Tu nombre">
                        </div>
                        
                        <div class="form-group">
                            <label for="tipo">Tipo de Requerimiento</label>
                            <select id="tipo" class="form-select">
                                <option value="">Seleccionar...</option>
                                <option value="Agua Potable">Agua Potable</option>
                                <option value="Alcantarillado">Alcantarillado</option>
                                <option value="Alumbrado P√∫blico">Alumbrado P√∫blico</option>
                                <option value="V√≠as">V√≠as</option>
                                <option value="Seguridad">Seguridad</option>
                                <option value="Limpieza">Limpieza</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="comentarios">Comentarios</label>
                            <textarea id="comentarios" class="form-textarea" placeholder="Describe el problema o requerimiento"></textarea>
                        </div>
                        
                        <!-- Selecci√≥n de ubicaci√≥n para el reporte -->
                        <div class="form-group">
                            <label>Ubicaci√≥n del Reporte</label>
                            <div class="coords-container">
                                <div class="coords-display">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span id="coords-text">No seleccionada</span>
                                </div>
                                
                                <div class="coords-actions">
                                    <button type="button" id="pick-on-map" class="btn btn-map">
                                        <i class="fas fa-map-pin"></i>
                                        Seleccionar en Mapa
                                    </button>
                                </div>
                                
                                <div class="coords-manual">
                                    <label>Coordenadas Manuales</label>
                                    <div class="coords-inputs">
                                        <input type="number" id="lat-input" placeholder="Latitud" step="any" class="coord-input">
                                    </div>
                                    <div class="coords-inputs">
                                        <input type="number" id="lng-input" placeholder="Longitud" step="any" class="coord-input">
                                    </div>
                                    <div class="coords-inputs">
                                        <button type="button" id="set-manual-coords" class="btn btn-set">
                                            <i class="fas fa-check"></i>
                                            Establecer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bot√≥n para enviar el reporte -->
                        <button type="button" id="report-send" class="btn btn-send">
                            <i class="fas fa-paper-plane"></i>
                            Enviar Reporte
                        </button>
                    </div>
                </div>
            </div>

            <!-- PANEL DE ESTADO DE LA CONEXI√ìN -->
            <div id="status" class="status-panel"></div>
        </aside>

        <!-- CONTENEDOR DEL MAPA PRINCIPAL -->
        <main class="map-container">
            <div id="map" class="map"></div>
            
            <!-- CONTROLES DEL MAPA -->
            <div class="map-controls">
                <button class="control-btn" title="Zoom al alcance total" onclick="zoomToAll()">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="control-btn" title="Limpiar mapa" onclick="limpiarMapa()">
                    <i class="fas fa-broom"></i>
                </button>
                <button class="control-btn" title="Cargar reportes" onclick="cargarReportes()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            
            <!-- LEYENDA DEL MAPA -->
            <div id="legend" class="legend" style="display: none;">
                <div class="legend-title">
                    <i class="fas fa-layer-group"></i>
                    Leyenda
                </div>
                <div id="legend-content"></div>
            </div>
        </main>
    </div>

    <!-- MODAL PARA USO DE SUELO - SOLO INFORMACI√ìN -->
    <div id="uso-suelo-modal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-vector-square"></i>
                    Informaci√≥n de Uso de Suelo
                </h2>
                <button class="modal-close" id="close-modal">&times;</button>
            </div>
            
            <!-- Contenido de informaci√≥n -->
            <div class="modal-body">
                <div class="info-section">
                    <h3 class="info-section-title">
                        <i class="fas fa-info-circle"></i>
                        Informaci√≥n General
                    </h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Uso Actual</div>
                            <div class="info-value" id="info-uso-actual">No disponible</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Clasificaci√≥n</div>
                            <div class="info-value" id="info-clasificacion">No disponible</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">√Årea</div>
                            <div class="info-value" id="info-area">No disponible</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Descripci√≥n</div>
                            <div class="info-value" id="info-descripcion">No disponible</div>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3 class="info-section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Ubicaci√≥n
                    </h3>
                    <div class="coords-display">
                        <i class="fas fa-crosshairs"></i>
                        <span id="info-coords-centroide">No calculado</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" id="close-info">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- ANIMACI√ìN DE √âXITO -->
    <div id="success-animation" class="success-animation">
        <div class="sombrero-container">
            <div class="sombrero">ü§†</div>
        </div>
        <div class="success-message">¬°Reporte Enviado con √âxito!</div>
        <div class="success-submessage">Gracias por construir un futuro mejor</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ===== CONFIGURACI√ìN DE SUPABASE =====
        const SUPABASE_URL = 'https://zrjsvoorlsresywgivof.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyanN2b29ybHNyZXN5d2dpdm9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MTU3NDgsImV4cCI6MjA3NjE5MTc0OH0.rYeKz_6aDvlatFgGYfe6l-Ec757pFdSlsOmFgr-mLmM';

        // ===== CLASIFICACIONES √öNICAS DE USO DE SUELO =====
        const clasificacionesUsoSuelo = [
            "√Årea Natural Protegida",
            "√Årea Verde",
            "Agroindustria",
            "Centro Hist√≥rico Per√≠metro \"A\"",
            "Centro Hist√≥rico Per√≠metro \"B\"",
            "Comercios de Intensidad Alta",
            "Comercios de Intensidad Baja", 
            "Comercios de Intensidad Media",
            "Equipamiento Urbano",
            "Habitacional de Densidad Alta",
            "Habitacional de Densidad Baja",
            "Habitacional de Densidad Media",
            "Habitacional de Densidad Media Mixta Comercio, Servicios e Industria Condicionados",
            "Habitacional de Densidad Muy Baja",
            "Habitacional Rural",
            "Industria de Intensidad Alta",
            "Industria de Intensidad Baja",
            "Industria de Intensidad Media", 
            "Infraestructura",
            "Servicios Carreteros",
            "Servicios de Intensidad Alta",
            "Servicios de Intensidad Baja",
            "Servicios de Intensidad Media",
            "Usos Especiales",
            "Zona Agr√≠cultura de Riego",
            "Zona Agricola de Temporal",
            "Zona Agropecuaria Mixta",
            "Zona con Actividades Extractivas",
            "Zona con Pasivo Ambiental", 
            "Zona de Conservaci√≥n Ecol√≥gica",
            "Zona de Consolidaci√≥n Urbana",
            "Zona de Reserva para Crecimiento",
            "Zona de Restauraci√≥n Ecol√≥gica"
        ];

        // ===== VARIABLES GLOBALES =====
        let map;
        let capasCargadas = {};
        let currentBasemap = 'osm';
        let selectedLocation = null;
        let locationMarker = null;
        let isPickingLocation = false;
        let localidadesData = [];
        let coloniasData = [];
        let reportesLayer = null;
        let reportesCargados = [];
        let selectedPolygonData = null;

        // ===== INICIALIZACI√ìN DE LA APLICACI√ìN =====
        document.addEventListener('DOMContentLoaded', function() {
            inicializarMapa();
            inicializarBasemaps();
            cargarCapasDisponibles();
            inicializarEventos();
            cargarDatosBusqueda();
            cargarReportes();
        });

        // ===== FUNCI√ìN: CARGAR DATOS PARA B√öSQUEDA (LOCALIDADES Y COLONIAS) =====
        async function cargarDatosBusqueda() {
            await Promise.all([
                cargarLocalidades(),
                cargarColonias()
            ]);
        }

        // ===== FUNCI√ìN: CARGAR LOCALIDADES PARA B√öSQUEDA =====
        async function cargarLocalidades() {
            try {
                const respuesta = await fetch(`${SUPABASE_URL}/rest/v1/Localidades%201?select=*,geom`, {
                    headers: { 
                        'apikey': SUPABASE_KEY, 
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!respuesta.ok) throw new Error(`Error ${respuesta.status}: ${respuesta.statusText}`);
                
                const datos = await respuesta.json();
                localidadesData = datos.map(item => ({
                    ...item,
                    tipo: 'localidad'
                }));
                
                console.log(`‚úÖ ${localidadesData.length} localidades cargadas para b√∫squeda`);
                
            } catch (error) {
                console.error('Error al cargar localidades:', error);
            }
        }

        // ===== FUNCI√ìN: CARGAR COLONIAS PARA B√öSQUEDA =====
        async function cargarColonias() {
            try {
                const respuesta = await fetch(`${SUPABASE_URL}/rest/v1/Colonias_SFR?select=*,geom`, {
                    headers: { 
                        'apikey': SUPABASE_KEY, 
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!respuesta.ok) throw new Error(`Error ${respuesta.status}: ${respuesta.statusText}`);
                
                const datos = await respuesta.json();
                coloniasData = datos.map(item => ({
                    ...item,
                    tipo: 'colonia'
                }));
                
                console.log(`‚úÖ ${coloniasData.length} colonias cargadas para b√∫squeda`);
                
            } catch (error) {
                console.error('Error al cargar colonias:', error);
            }
        }

        // ===== FUNCI√ìN: BUSCAR LOCALIDADES Y COLONIAS =====
        function buscarLocalidades(termino) {
            const resultadosContainer = document.getElementById('search-results');
            resultadosContainer.innerHTML = '';
            
            if (!termino || termino.length < 2) {
                resultadosContainer.style.display = 'none';
                return;
            }
            
            const terminoLower = termino.toLowerCase();
            
            // Buscar en localidades
            const resultadosLocalidades = localidadesData.filter(item => {
                return item.nom_loc && item.nom_loc.toLowerCase().includes(terminoLower);
            }).slice(0, 5);
            
            // Buscar en colonias
            const resultadosColonias = coloniasData.filter(item => {
                return item.nomcolonia && item.nomcolonia.toLowerCase().includes(terminoLower);
            }).slice(0, 5);
            
            const resultados = [...resultadosLocalidades, ...resultadosColonias].slice(0, 10);
            
            if (resultados.length === 0) {
                resultadosContainer.style.display = 'none';
                return;
            }
            
            resultados.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'search-result-item';
                
                let nombre = '';
                let tipoTexto = '';
                
                if (item.tipo === 'localidad') {
                    nombre = item.nom_loc;
                    tipoTexto = 'Localidad';
                } else if (item.tipo === 'colonia') {
                    nombre = item.nomcolonia;
                    tipoTexto = 'Colonia';
                }
                
                itemElement.innerHTML = `
                    <div>${nombre}</div>
                    <div class="result-type">${tipoTexto}</div>
                `;
                
                itemElement.onclick = () => {
                    seleccionarResultadoBusqueda(item);
                    resultadosContainer.style.display = 'none';
                    document.getElementById('search-input').value = nombre;
                };
                
                resultadosContainer.appendChild(itemElement);
            });
            
            resultadosContainer.style.display = 'block';
        }

        // ===== FUNCI√ìN: SELECCIONAR RESULTADO DE B√öSQUEDA =====
        function seleccionarResultadoBusqueda(item) {
            const geometria = postgisToGeoJSON(item.geom);
            
            if (geometria) {
                let lat, lng;
                
                // Manejar diferentes tipos de geometr√≠a
                if (geometria.type === 'Point' && geometria.coordinates) {
                    [lng, lat] = geometria.coordinates;
                } else if (geometria.type === 'Polygon' || geometria.type === 'MultiPolygon') {
                    // Para pol√≠gonos, calcular el centroide
                    const bounds = L.geoJSON(geometria).getBounds();
                    const centro = bounds.getCenter();
                    lat = centro.lat;
                    lng = centro.lng;
                } else {
                    alert('No se pudo obtener la ubicaci√≥n del elemento seleccionado');
                    return;
                }
                
                map.setView([lat, lng], 14);
                
                if (locationMarker) {
                    map.removeLayer(locationMarker);
                }
                
                let iconColor = '#3b82f6';
                let tipoTexto = '';
                
                if (item.tipo === 'localidad') {
                    iconColor = '#3b82f6';
                    tipoTexto = 'Localidad';
                } else if (item.tipo === 'colonia') {
                    iconColor = '#10b981';
                    tipoTexto = 'Colonia';
                }
                
                locationMarker = L.marker([lat, lng], {
                    icon: L.divIcon({
                        className: 'location-marker',
                        html: `<i class="fas fa-map-marker-alt" style="color: ${iconColor}; font-size: 24px;"></i>`,
                        iconSize: [24, 24],
                        iconAnchor: [12, 24]
                    })
                }).addTo(map);
                
                let contenidoPopup = `<strong>${tipoTexto}: ${item.nom_loc || item.nomcolonia}</strong>`;
                
                if (item.tipo === 'localidad') {
                    if (item.nom_mun) contenidoPopup += `<br>Municipio: ${item.nom_mun}`;
                    if (item.nom_ent) contenidoPopup += `<br>Entidad: ${item.nom_ent}`;
                    if (item.pobtot) contenidoPopup += `<br>Poblaci√≥n: ${item.pobtot}`;
                } else if (item.tipo === 'colonia') {
                    // Agregar m√°s informaci√≥n de colonias si est√° disponible
                    if (item.area) contenidoPopup += `<br>√Årea: ${item.area}`;
                }
                
                locationMarker.bindPopup(contenidoPopup).openPopup();
                
                establecerUbicacion(lat, lng);
                
            } else {
                alert('No se pudo obtener la ubicaci√≥n del elemento seleccionado');
            }
        }

        // ===== FUNCI√ìN: INICIALIZAR MAPA =====
        function inicializarMapa() {
            map = L.map('map').setView([23.6345, -102.5528], 5);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            L.control.scale({ imperial: false }).addTo(map);
        }

        // ===== FUNCI√ìN: CARGAR REPORTES =====
        async function cargarReportes() {
            try {
                const respuesta = await fetch(`${SUPABASE_URL}/rest/v1/reportes_ciudadanos?select=*`, {
                    headers: { 
                        'apikey': SUPABASE_KEY, 
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!respuesta.ok) throw new Error(`Error ${respuesta.status}: ${respuesta.statusText}`);
                
                const datos = await respuesta.json();
                reportesCargados = datos;
                
                if (reportesLayer) {
                    map.removeLayer(reportesLayer);
                }
                
                const features = datos.map(reporte => {
                    let geometria = null;
                    
                    if (reporte.geom) {
                        geometria = postgisToGeoJSON(reporte.geom);
                    }
                    
                    if (!geometria && reporte.lat && reporte.lng) {
                        geometria = {
                            type: 'Point',
                            coordinates: [reporte.lng, reporte.lat]
                        };
                    }
                    
                    if (geometria) {
                        return {
                            type: 'Feature',
                            geometry: geometria,
                            properties: reporte
                        };
                    }
                    return null;
                }).filter(feature => feature !== null);
                
                const geoJSONData = {
                    type: 'FeatureCollection',
                    features: features
                };
                
                reportesLayer = L.geoJSON(geoJSONData, {
                    pointToLayer: function(feature, latlng) {
                        let estado = feature.properties.estado || 'pendiente';
                        let colorClass = 'report-pendiente';
                        let icono = 'fas fa-exclamation-circle';
                        
                        if (estado === 'en proceso') {
                            colorClass = 'report-en-proceso';
                            icono = 'fas fa-tools';
                        } else if (estado === 'resuelto') {
                            colorClass = 'report-resuelto';
                            icono = 'fas fa-check-circle';
                        }
                        
                        return L.marker(latlng, {
                            icon: L.divIcon({
                                className: 'report-marker',
                                html: `<div class="report-icon ${colorClass}"><i class="${icono}"></i></div>`,
                                iconSize: [24, 24],
                                iconAnchor: [12, 12]
                            })
                        });
                    },
                    onEachFeature: function(feature, layer) {
                        const reporte = feature.properties;
                        let contenidoPopup = `
                            <div style="min-width: 200px;">
                                <strong>${reporte.nombre || 'An√≥nimo'}</strong><br>
                                <small>${new Date(reporte.fecha_creacion).toLocaleDateString()}</small>
                                <hr style="margin: 5px 0;">
                                <strong>Tipo:</strong> ${reporte.tipo_requerimiento}<br>
                                <strong>Estado:</strong> ${reporte.estado || 'pendiente'}<br>
                                <strong>Comentarios:</strong> ${reporte.comentarios || 'Sin comentarios'}
                            </div>
                        `;
                        layer.bindPopup(contenidoPopup);
                    }
                }).addTo(map);
                
                console.log(`‚úÖ ${datos.length} reportes cargados`);
                
            } catch (error) {
                console.error('Error al cargar reportes:', error);
            }
        }

        // ===== FUNCI√ìN: ENVIAR REPORTE =====
        async function enviarReporte() {
            const nombre = document.getElementById('nombre').value.trim();
            const tipo = document.getElementById('tipo').value;
            const comentarios = document.getElementById('comentarios').value.trim();
            
            if (!nombre || !tipo || !comentarios) {
                alert('Por favor completa todos los campos obligatorios');
                return;
            }
            
            if (!selectedLocation) {
                alert('Por favor selecciona una ubicaci√≥n para el reporte');
                return;
            }
            
            try {
                const reporteData = {
                    nombre: nombre,
                    tipo_requerimiento: tipo,
                    comentarios: comentarios,
                    lat: selectedLocation.lat,
                    lng: selectedLocation.lng
                };
                
                const respuesta = await fetch(`${SUPABASE_URL}/rest/v1/reportes_ciudadanos`, {
                    method: 'POST',
                    headers: { 
                        'apikey': SUPABASE_KEY, 
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(reporteData)
                });
                
                if (!respuesta.ok) {
                    const errorData = await respuesta.json();
                    throw new Error(`Error ${respuesta.status}: ${JSON.stringify(errorData)}`);
                }
                
                const nuevoReporte = await respuesta.json();
                
                // Mostrar animaci√≥n de √©xito
                mostrarAnimacionExito();
                
                // Limpiar formulario
                document.getElementById('nombre').value = '';
                document.getElementById('tipo').value = '';
                document.getElementById('comentarios').value = '';
                document.getElementById('coords-text').textContent = 'No seleccionada';
                document.getElementById('lat-input').value = '';
                document.getElementById('lng-input').value = '';
                
                if (locationMarker) {
                    map.removeLayer(locationMarker);
                    locationMarker = null;
                }
                
                selectedLocation = null;
                cargarReportes();
                
            } catch (error) {
                console.error('Error al enviar reporte:', error);
                alert('‚ùå Error al enviar el reporte: ' + error.message);
            }
        }

        // ===== FUNCI√ìN: MOSTRAR ANIMACI√ìN DE √âXITO =====
        function mostrarAnimacionExito() {
            const animacion = document.getElementById('success-animation');
            const sombreroContainer = document.querySelector('.sombrero-container');
            
            // Activar la animaci√≥n
            animacion.classList.add('active');
            
            // Crear fuegos artificiales
            crearFuegosArtificiales(sombreroContainer);
            
            // Ocultar animaci√≥n despu√©s de 4 segundos
            setTimeout(() => {
                animacion.classList.remove('active');
            }, 4000);
        }

        // ===== FUNCI√ìN: CREAR FUEGOS ARTIFICIALES =====
        function crearFuegosArtificiales(container) {
            const colors = ['#FFD700', '#FF4500', '#00FF7F', '#1E90FF', '#FF1493', '#FFA500'];
            
            for (let i = 0; i < 30; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                
                // Posici√≥n aleatoria
                const angle = Math.random() * Math.PI * 2;
                const distance = 50 + Math.random() * 100;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                // Color aleatorio
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                firework.style.cssText = `
                    --tx: ${tx}px;
                    --ty: ${ty}px;
                    background: ${color};
                    box-shadow: 0 0 10px 2px ${color};
                    animation-delay: ${Math.random() * 0.5}s;
                `;
                
                container.appendChild(firework);
                
                // Eliminar el elemento despu√©s de la animaci√≥n
                setTimeout(() => {
                    if (firework.parentNode) {
                        firework.parentNode.removeChild(firework);
                    }
                }, 1500);
            }
        }

        // ===== FUNCI√ìN: ESTABLECER UBICACI√ìN =====
        function establecerUbicacion(lat, lng) {
            selectedLocation = { lat, lng };
            
            document.getElementById('coords-text').textContent = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            document.getElementById('lat-input').value = lat;
            document.getElementById('lng-input').value = lng;
            
            if (locationMarker) {
                map.removeLayer(locationMarker);
            }
            
            locationMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'selected-location-marker',
                    html: '<i class="fas fa-map-marker-alt" style="color: #ef4444; font-size: 32px; text-shadow: 0 0 8px rgba(255,255,255,0.8);"></i>',
                    iconSize: [32, 32],
                    iconAnchor: [16, 32]
                }),
                zIndexOffset: 1000
            }).addTo(map);
            
            locationMarker.bindPopup(`
                <div style="text-align: center;">
                    <strong>Ubicaci√≥n seleccionada</strong><br>
                    Lat: ${lat.toFixed(6)}<br>
                    Lng: ${lng.toFixed(6)}
                </div>
            `).openPopup();
            
            map.setView([lat, lng], Math.max(map.getZoom(), 16));
        }

        // ===== FUNCIONES DE CONVERSI√ìN DE GEOMETR√çA =====
        function postgisToGeoJSON(geom) {
            if (!geom) return null;
            
            try {
                if (typeof geom === 'object') {
                    return geom;
                }
                
                if (typeof geom === 'string') {
                    try {
                        const geoJSON = JSON.parse(geom);
                        if (geoJSON.type && geoJSON.coordinates) {
                            return geoJSON;
                        }
                    } catch (e) {
                        console.log('No es GeoJSON, intentando como WKT...');
                    }
                    
                    if (geom.includes('POLYGON') || geom.includes('LINESTRING') || geom.includes('POINT')) {
                        return wktToGeoJSON(geom);
                    }
                }
                
                console.warn('Formato de geometr√≠a no reconocido:', geom);
                return null;
            } catch (error) {
                console.error('Error convirtiendo geometr√≠a:', error, geom);
                return null;
            }
        }

        function wktToGeoJSON(wkt) {
            try {
                if (wkt.includes('POINT')) {
                    const coordsMatch = wkt.match(/POINT\s*\(\s*([-\d.]+)\s+([-\d.]+)\s*\)/);
                    if (coordsMatch) {
                        const lng = parseFloat(coordsMatch[1]);
                        const lat = parseFloat(coordsMatch[2]);
                        return {
                            type: 'Point',
                            coordinates: [lng, lat]
                        };
                    }
                }
                else if (wkt.includes('MULTIPOLYGON')) {
                    const coordsMatch = wkt.match(/\(\(\(([^)]+)\)\)\)/);
                    if (coordsMatch) {
                        const coords = coordsMatch[1].split(',').map(coord => {
                            const [lng, lat] = coord.trim().split(' ').map(Number);
                            return [lng, lat];
                        });
                        
                        return {
                            type: 'MultiPolygon',
                            coordinates: [[coords]]
                        };
                    }
                }
                
                return null;
            } catch (error) {
                console.error('Error convirtiendo WKT:', error);
                return null;
            }
        }

        // ===== FUNCI√ìN: INICIALIZAR BASEMAPS =====
        function inicializarBasemaps() {
            const basemaps = [
                { id: 'osm', name: 'OpenStreetMap', icon: 'fas fa-globe-americas', active: true },
                { id: 'satellite', name: 'Sat√©lite', icon: 'fas fa-satellite' },
                { id: 'terrain', name: 'Relieve', icon: 'fas fa-mountain' },
                { id: 'dark', name: 'Oscuro', icon: 'fas fa-moon' }
            ];

            const basemapGrid = document.getElementById('basemaps');
            basemapGrid.innerHTML = '';

            basemaps.forEach(basemap => {
                const basemapItem = document.createElement('div');
                basemapItem.className = `basemap-item ${basemap.active ? 'active' : ''}`;
                basemapItem.innerHTML = `
                    <i class="${basemap.icon}"></i>
                    <span>${basemap.name}</span>
                `;
                basemapItem.onclick = () => cambiarBasemap(basemap.id);
                basemapGrid.appendChild(basemapItem);
            });
        }

        // ===== FUNCI√ìN: CAMBIAR BASEMAP =====
        function cambiarBasemap(basemapId) {
            map.eachLayer(layer => {
                if (layer instanceof L.TileLayer) {
                    map.removeLayer(layer);
                }
            });

            let newBasemap;
            switch(basemapId) {
                case 'satellite':
                    newBasemap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
                    });
                    break;
                case 'terrain':
                    newBasemap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}', {
                        attribution: 'Tiles &copy; Esri &mdash; Source: Esri'
                    });
                    break;
                case 'dark':
                    newBasemap = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
                    });
                    break;
                default:
                    newBasemap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    });
            }

            newBasemap.addTo(map);
            currentBasemap = basemapId;

            document.querySelectorAll('.basemap-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.basemap-item:nth-child(${['osm', 'satellite', 'terrain', 'dark'].indexOf(basemapId) + 1})`).classList.add('active');

            Object.values(capasCargadas).forEach(capa => {
                capa.addTo(map);
            });
            
            if (reportesLayer) {
                reportesLayer.addTo(map);
            }
        }

        // ===== FUNCI√ìN: CARGAR CAPAS DISPONIBLES =====
        async function cargarCapasDisponibles() {
            const status = document.getElementById('status');
            const layersContainer = document.getElementById('layers');
            
            status.textContent = 'üîç Cargando capas disponibles...';
            status.className = 'status-panel';
            
            try {
                const tablasEspaciales = [
                    'Localidades 1', 
                    'San Francisco_Mun', 
                    'Usos de Suelo ',
                    'Zonificaci√≥n Primaria_',
                    'Colonias_SFR'
                ];
                const capasValidas = [];
                
                for (const tabla of tablasEspaciales) {
                    try {
                        const r = await fetch(`${SUPABASE_URL}/rest/v1/${encodeURIComponent(tabla)}?limit=1`, {
                            headers: { 
                                'apikey': SUPABASE_KEY, 
                                'Authorization': `Bearer ${SUPABASE_KEY}`,
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (r.ok) {
                            capasValidas.push(tabla);
                            console.log(`‚úÖ Capa accesible: ${tabla}`);
                        } else {
                            console.log(`‚ùå Capa no accesible: ${tabla}`);
                        }
                    } catch (e) {
                        console.error(`Error al acceder a ${tabla}:`, e);
                    }
                }
                
                if (capasValidas.length === 0) {
                    status.textContent = '‚ùå No se encontraron capas espaciales accesibles.';
                    status.className = 'status-panel error';
                    return;
                }
                
                status.textContent = `‚úÖ ${capasValidas.length} capa(s) disponible(s)`;
                status.className = 'status-panel success';
                
                layersContainer.innerHTML = '';
                capasValidas.forEach(capa => {
                    const tipoGeometria = obtenerTipoGeometria(capa);
                    const color = obtenerColorPorTipo(tipoGeometria);
                    const icono = obtenerIconoPorTipo(tipoGeometria);
                    
                    const layerItem = document.createElement('div');
                    layerItem.className = 'layer-item';
                    layerItem.innerHTML = `
                        <div class="layer-icon" style="background-color: ${color};">
                            <i class="${icono}"></i>
                        </div>
                        <div class="layer-info">
                            <div class="layer-name">${formatearNombre(capa)}</div>
                            <div class="layer-type">${tipoGeometria}</div>
                        </div>
                        <div class="layer-toggle"></div>
                    `;
                    
                    layerItem.onclick = () => toggleCapa(capa);
                    layersContainer.appendChild(layerItem);
                });
                
            } catch (err) {
                status.textContent = '‚ùå Error de conexi√≥n: ' + err.message;
                status.className = 'status-panel error';
                console.error(err);
            }
        }

        // ===== FUNCI√ìN: OBTENER TIPO DE GEOMETR√çA =====
        function obtenerTipoGeometria(nombreTabla) {
            if (nombreTabla.includes('Localidades') || nombreTabla.includes('reportes') || nombreTabla.includes('propuestas')) {
                return 'Punto';
            } else if (nombreTabla.includes('Zonificaci√≥n') || nombreTabla.includes('San Francisco') || 
                       nombreTabla.includes('Usos de Suelo') || nombreTabla.includes('Colonias_SFR')) {
                return 'Pol√≠gono';
            }
            return 'Desconocido';
        }

        // ===== FUNCI√ìN: OBTENER COLOR POR TIPO =====
        function obtenerColorPorTipo(tipo) {
            switch(tipo) {
                case 'Pol√≠gono': return '#3498db';
                case 'Punto': return '#e74c3c';
                default: return '#95a5a6';
            }
        }

        // ===== FUNCI√ìN: OBTENER ICONO POR TIPO =====
        function obtenerIconoPorTipo(tipo) {
            switch(tipo) {
                case 'Pol√≠gono': return 'fas fa-vector-square';
                case 'Punto': return 'fas fa-map-marker-alt';
                default: return 'fas fa-question';
            }
        }

        // ===== FUNCI√ìN: FORMATEAR NOMBRE =====
        function formatearNombre(nombre) {
            const nombresEspeciales = {
                'Localidades 1': 'Localidades',
                'San Francisco_Mun': 'Municipio San Francisco',
                'Usos de Suelo ': 'Usos de Suelo',
                'Zonificaci√≥n Primaria_': 'Zonificaci√≥n Primaria',
                'Colonias_SFR': 'Colonias San Francisco'
            };
            
            if (nombresEspeciales[nombre]) {
                return nombresEspeciales[nombre];
            }
            
            return nombre
                .replace(/_/g, ' ')
                .replace(/\s+\d+$/, '')
                .replace(/^\w/, c => c.toUpperCase());
        }

        // ===== FUNCI√ìN MEJORADA: TOGGLE CAPA (CON COLOR_HEX) =====
        async function toggleCapa(nombreCapa) {
            const layerItems = document.querySelectorAll('.layer-item');
            let layerItem, toggle;
            
            for (let item of layerItems) {
                if (item.querySelector('.layer-name').textContent === formatearNombre(nombreCapa)) {
                    layerItem = item;
                    toggle = item.querySelector('.layer-toggle');
                    break;
                }
            }
            
            if (!layerItem) return;
            
            if (capasCargadas[nombreCapa]) {
                map.removeLayer(capasCargadas[nombreCapa]);
                delete capasCargadas[nombreCapa];
                toggle.classList.remove('active');
                layerItem.classList.remove('active');
                actualizarLeyenda();
                return;
            }
            
            toggle.classList.add('active');
            layerItem.classList.add('active');
            
            try {
                const respuesta = await fetch(`${SUPABASE_URL}/rest/v1/${encodeURIComponent(nombreCapa)}?select=*`, {
                    headers: { 
                        'apikey': SUPABASE_KEY, 
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!respuesta.ok) throw new Error(`Error ${respuesta.status}: ${respuesta.statusText}`);
                
                const datos = await respuesta.json();
                
                const features = [];
                
                datos.forEach(fila => {
                    const geometria = postgisToGeoJSON(fila.geom);
                    
                    if (geometria) {
                        const propiedades = { ...fila };
                        delete propiedades.geom;
                        
                        features.push({
                            type: 'Feature',
                            geometry: geometria,
                            properties: propiedades
                        });
                    }
                });
                
                if (features.length === 0) {
                    alert(`No se pudieron procesar las geometr√≠as de la capa ${formatearNombre(nombreCapa)}`);
                    toggle.classList.remove('active');
                    layerItem.classList.remove('active');
                    return;
                }
                
                const geoJSONData = {
                    type: 'FeatureCollection',
                    features: features
                };
                
                const tipoGeometria = obtenerTipoGeometria(nombreCapa);
                const colorBase = obtenerColorPorTipo(tipoGeometria);
                
                // ===== ESTILO MEJORADO QUE USA COLOR_HEX SI EXISTE =====
                const style = function(feature) {
                    // Usar color_hex si existe, sino usar color base por tipo
                    const color = feature.properties.color_hex || colorBase;
                    return {
                        color: color,
                        weight: 2,
                        opacity: 0.8,
                        fillColor: color,
                        fillOpacity: 0.4
                    };
                };
                
                const pointToLayer = function(feature, latlng) {
                    // Usar color_hex si existe, sino usar color base por tipo
                    const color = feature.properties.color_hex || colorBase;
                    return L.circleMarker(latlng, {
                        radius: 6,
                        fillColor: color,
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    });
                };
                
                const capa = L.geoJSON(geoJSONData, {
                    pointToLayer: tipoGeometria === 'Punto' ? pointToLayer : undefined,
                    style: tipoGeometria !== 'Punto' ? style : undefined,
                    onEachFeature: function(feature, layer) {
                        let contenidoPopup = `<strong>${formatearNombre(nombreCapa)}</strong><br><hr>`;
                        
                        const propiedadesEspecificas = {
                            'Localidades 1': ['nom_loc', 'nom_ent', 'nom_mun', 'pobtot'],
                            'San Francisco_Mun': ['nomgeo', 'nom_ent'],
                            'Usos de Suelo ': ['clas_b√°s', 'desc_cve', 'area', 'color_hex'],
                            'Zonificaci√≥n Primaria_': ['descripcio', 'codigo', '√°rea_ha'],
                            'Colonias_SFR': ['nomcolonia']
                        };
                        
                        const propiedades = propiedadesEspecificas[nombreCapa] || Object.keys(feature.properties).slice(0, 5);
                        
                        propiedades.forEach(prop => {
                            if (feature.properties[prop] !== null && 
                                feature.properties[prop] !== undefined) {
                                contenidoPopup += `<strong>${prop}:</strong> ${feature.properties[prop]}<br>`;
                            }
                        });
                        
                        layer.bindPopup(contenidoPopup);
                        
                        // ===== AGREGAR EVENTO DE CLIC PARA USOS DE SUELO =====
                        if (nombreCapa === 'Usos de Suelo ') {
                            layer.on('click', function(e) {
                                e.originalEvent.preventDefault();
                                e.originalEvent.stopPropagation();
                                
                                // Abrir modal con pesta√±as para uso de suelo
                                openUsoSueloModal(feature.properties, feature);
                            });
                        }
                    }
                });
                
                capa.addTo(map);
                capasCargadas[nombreCapa] = capa;
                
                if (Object.keys(capasCargadas).length === 1) {
                    map.fitBounds(capa.getBounds(), { padding: [20, 20] });
                }
                
                actualizarLeyenda();
                
            } catch (error) {
                console.error(`Error al cargar ${nombreCapa}:`, error);
                alert(`Error al cargar la capa ${formatearNombre(nombreCapa)}: ${error.message}`);
                toggle.classList.remove('active');
                layerItem.classList.remove('active');
            }
        }

        // ===== FUNCI√ìN MEJORADA: ACTUALIZAR LEYENDA (CON CLASIFICACI√ìN desc_cve Y SCROLL) =====
        function actualizarLeyenda() {
            const leyenda = document.getElementById('legend');
            const leyendaContent = document.getElementById('legend-content');
            const capasActivas = Object.keys(capasCargadas);
            
            if (capasActivas.length === 0) {
                leyenda.style.display = 'none';
                return;
            }
            
            let contenidoLeyenda = '';
            let totalItems = 0;
            
            capasActivas.forEach(capa => {
                // Para la capa "Usos de Suelo", mostrar las clasificaciones de desc_cve con sus colores
                if (capa === 'Usos de Suelo ') {
                    const geojson = capasCargadas[capa]?.toGeoJSON();
                    if (geojson) {
                        // Obtener clasificaciones √∫nicas de la capa con sus colores
                        const clasificaciones = {};
                        
                        geojson.features.forEach(feature => {
                            const clasificacion = feature.properties.desc_cve;
                            const color = feature.properties.color_hex || obtenerColorPorTipo('Pol√≠gono');
                            
                            if (clasificacion && !clasificaciones[clasificacion]) {
                                clasificaciones[clasificacion] = color;
                            }
                        });
                        
                        // Ordenar las clasificaciones alfab√©ticamente
                        const clasificacionesOrdenadas = Object.keys(clasificaciones).sort();
                        totalItems = clasificacionesOrdenadas.length;
                        
                        if (clasificacionesOrdenadas.length > 0) {
                            contenidoLeyenda += `<div class="legend-title">${formatearNombre(capa)}</div>`;
                            clasificacionesOrdenadas.forEach(clasificacion => {
                                const color = clasificaciones[clasificacion];
                                contenidoLeyenda += `
                                    <div class="legend-item">
                                        <div class="legend-color" style="background-color:${color}"></div>
                                        <div class="legend-text">${clasificacion}</div>
                                    </div>
                                `;
                            });
                            return; // Salir del bucle para esta capa
                        }
                    }
                }
                
                // Para otras capas, usar el color por defecto
                const tipo = obtenerTipoGeometria(capa);
                const color = obtenerColorPorTipo(tipo);
                contenidoLeyenda += `
                    <div class="legend-item">
                        <div class="legend-color" style="background-color:${color}"></div>
                        <div class="legend-text">${formatearNombre(capa)}</div>
                    </div>
                `;
                totalItems++;
            });
            
            leyendaContent.innerHTML = contenidoLeyenda;
            
            // Activar scroll solo si hay muchos elementos
            if (totalItems > 10) {
                leyendaContent.style.overflowY = 'auto';
                leyendaContent.style.maxHeight = '350px';
            } else {
                leyendaContent.style.overflowY = 'visible';
                leyendaContent.style.maxHeight = 'none';
            }
            
            leyenda.style.display = 'block';
        }

        // ===== FUNCI√ìN: ZOOM A TODO =====
        function zoomToAll() {
            const capasActivas = Object.values(capasCargadas);
            
            if (capasActivas.length === 0) {
                alert('No hay capas cargadas en el mapa');
                return;
            }
            
            const grupo = new L.featureGroup(capasActivas);
            map.fitBounds(grupo.getBounds(), { padding: [20, 20] });
        }

        // ===== FUNCI√ìN: LIMPIAR MAPA =====
        function limpiarMapa() {
            Object.values(capasCargadas).forEach(capa => {
                map.removeLayer(capa);
            });
            
            capasCargadas = {};
            
            document.querySelectorAll('.layer-item').forEach(item => {
                item.classList.remove('active');
                item.querySelector('.layer-toggle').classList.remove('active');
            });
            
            actualizarLeyenda();
        }

        // ===== FUNCI√ìN: INICIALIZAR EVENTOS =====
        function inicializarEventos() {
            // Eventos de b√∫squeda
            document.getElementById('search-input').addEventListener('input', function(e) {
                buscarLocalidades(e.target.value);
            });

            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    document.getElementById('search-results').style.display = 'none';
                }
            });

            // Eventos para formulario de reportes
            document.getElementById('pick-on-map').addEventListener('click', function() {
                activarSeleccionUbicacion();
            });

            document.getElementById('set-manual-coords').addEventListener('click', function() {
                const lat = parseFloat(document.getElementById('lat-input').value);
                const lng = parseFloat(document.getElementById('lng-input').value);
                
                if (!isNaN(lat) && !isNaN(lng)) {
                    establecerUbicacion(lat, lng);
                } else {
                    alert('Por favor ingresa coordenadas v√°lidas');
                }
            });

            document.getElementById('report-send').addEventListener('click', function() {
                enviarReporte();
            });

            // Eventos del mapa
            map.on('click', function(e) {
                if (isPickingLocation) {
                    establecerUbicacion(e.latlng.lat, e.latlng.lng);
                    desactivarSeleccionUbicacion();
                }
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (isPickingLocation) {
                        desactivarSeleccionUbicacion();
                    }
                }
            });

            // ===== EVENTOS PARA EL MODAL DE USO DE SUELO =====
            document.getElementById('close-modal').addEventListener('click', cerrarModalUsoSuelo);
            document.getElementById('close-info').addEventListener('click', cerrarModalUsoSuelo);
            
            // Cerrar modal al hacer clic fuera
            document.getElementById('uso-suelo-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    cerrarModalUsoSuelo();
                }
            });
        }

        // ===== FUNCIONES AUXILIARES PARA SELECCI√ìN DE UBICACI√ìN =====
        function activarSeleccionUbicacion() {
            isPickingLocation = true;
            map.getContainer().style.cursor = 'crosshair';
            mostrarMensajeSeleccion();
            document.getElementById('pick-on-map').disabled = true;
            document.getElementById('pick-on-map').innerHTML = '<i class="fas fa-map-pin"></i> Seleccionando...';
        }

        function desactivarSeleccionUbicacion() {
            isPickingLocation = false;
            map.getContainer().style.cursor = '';
            document.getElementById('pick-on-map').disabled = false;
            document.getElementById('pick-on-map').innerHTML = '<i class="fas fa-map-pin"></i> Seleccionar en Mapa';
            ocultarMensajeSeleccion();
        }

        function mostrarMensajeSeleccion() {
            let mensaje = document.getElementById('seleccion-mensaje');
            if (!mensaje) {
                mensaje = document.createElement('div');
                mensaje.id = 'seleccion-mensaje';
                mensaje.style.cssText = `
                    position: absolute;
                    top: 10px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(31, 41, 55, 0.95);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 8px;
                    z-index: 1000;
                    border: 1px solid var(--primary);
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    font-size: 14px;
                `;
                document.querySelector('.map-container').appendChild(mensaje);
            }
            mensaje.innerHTML = '<i class="fas fa-crosshairs"></i> Haz clic en el mapa para seleccionar ubicaci√≥n (ESC para cancelar)';
            mensaje.style.display = 'block';
        }

        function ocultarMensajeSeleccion() {
            const mensaje = document.getElementById('seleccion-mensaje');
            if (mensaje) {
                mensaje.style.display = 'none';
            }
        }

        // ===== FUNCIONES PARA MODAL DE USO DE SUELO =====
        function openUsoSueloModal(polygonData, feature) {
            // Obtener informaci√≥n del pol√≠gono
            const usoActual = polygonData.clas_b√°s || polygonData.desc_cve || 'No especificado';
            const clasificacion = polygonData.clas_b√°s || 'No disponible';
            const area = polygonData.area ? `${polygonData.area} ha` : 'No disponible';
            const descripcion = polygonData.desc_cve || 'No disponible';
            
            // Calcular centroide
            const centroide = calcularCentroide(feature);
            
            // Actualizar informaci√≥n
            document.getElementById('info-uso-actual').textContent = usoActual;
            document.getElementById('info-clasificacion').textContent = clasificacion;
            document.getElementById('info-area').textContent = area;
            document.getElementById('info-descripcion').textContent = descripcion;
            document.getElementById('info-coords-centroide').textContent = `${centroide.lat.toFixed(6)}, ${centroide.lng.toFixed(6)}`;
            
            // Mostrar modal
            document.getElementById('uso-suelo-modal').style.display = 'flex';
        }

        function calcularCentroide(feature) {
            const geometry = feature.geometry;
            
            if (geometry.type === 'Polygon') {
                const coordinates = geometry.coordinates[0];
                let latSum = 0;
                let lngSum = 0;
                
                for (let i = 0; i < coordinates.length; i++) {
                    lngSum += coordinates[i][0];
                    latSum += coordinates[i][1];
                }
                
                return {
                    lat: latSum / coordinates.length,
                    lng: lngSum / coordinates.length
                };
            } else if (geometry.type === 'MultiPolygon') {
                const coordinates = geometry.coordinates[0][0];
                let latSum = 0;
                let lngSum = 0;
                
                for (let i = 0; i < coordinates.length; i++) {
                    lngSum += coordinates[i][0];
                    latSum += coordinates[i][1];
                }
                
                return {
                    lat: latSum / coordinates.length,
                    lng: lngSum / coordinates.length
                };
            }
            
            const bounds = L.geoJSON(feature).getBounds();
            return bounds.getCenter();
        }

        function cerrarModalUsoSuelo() {
            document.getElementById('uso-suelo-modal').style.display = 'none';
        }

        // ===== FUNCI√ìN AUXILIAR PARA DEBUG =====
        async function verificarTablas() {
            console.log('üîç Verificando tablas en Supabase...');
            
            const tablas = [
                'Localidades 1', 
                'San Francisco_Mun', 
                'Usos de Suelo ',
                'Zonificaci√≥n Primaria_',
                'Colonias_SFR',
                'reportes_ciudadanos',
                'propuestas_ciudadanas'
            ];
            
            for (const tabla of tablas) {
                try {
                    const respuesta = await fetch(`${SUPABASE_URL}/rest/v1/${encodeURIComponent(tabla)}?limit=1`, {
                        headers: { 
                            'apikey': SUPABASE_KEY, 
                            'Authorization': `Bearer ${SUPABASE_KEY}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (respuesta.ok) {
                        console.log(`‚úÖ ${tabla}: ACCESIBLE`);
                    } else {
                        console.log(`‚ùå ${tabla}: NO ACCESIBLE (${respuesta.status})`);
                    }
                } catch (error) {
                    console.log(`‚ùå ${tabla}: ERROR - ${error.message}`);
                }
            }
        }
    </script>
</body>
</html>
